<?xml version="1.0" encoding="ISO-8859-1" standalone="no"?>
<!DOCTYPE database SYSTEM
 "http://jakarta.apache.org/turbine/dtd/database.dtd">

<!--
	- The maximum length for a varchar field is 1000
	- There are not unique indexes (beyond the primary keys). This is due to
	  the fact that hsql considers null as a value, therefore not accepting 
	  the rows with that column null (unique violation).
-->
<database
  name="betty"
  defaultIdMethod="none">
  
  <table name="entity" description="A company">
  	
  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	<column name="external_id" required="true" type="VARCHAR" size="20"/>
  	<column name="description" required="true" type="VARCHAR" size="100"/>
  	<column name="create_datetime" required="true" type="TIMESTAMP"></column>
  	<column name="language_id" required="true" type="INTEGER"/>
  	<column name="currency_id" required="true" type="INTEGER"
  		description="The default currency. It has to be in the map as well"/>
  	
    <foreign-key foreignTable="language">
    	<reference foreign="id" local="language_id"/>
    </foreign-key>
    <foreign-key foreignTable="currency">
    	<reference foreign="id" local="currency_id"/>
    </foreign-key>
  	
  	<unique>
       <unique-column name="external_id"/>
    </unique>
  	
  </table>


  <table name="base_user" description="Main users table">
  	
    <column name="id" required="true" primaryKey="true" type="INTEGER" />
    <column name="entity_id" required="false" type="INTEGER"/>
    <column name="user_name" required="false" type="VARCHAR" size="20" />
    <column name="password" required="false" type="VARCHAR" size="20" />
    <column name="deleted" required="true" default="0" type="BOOLEANINT"/>
  	<column name="language_id" required="false" type="INTEGER"/>
  	<column name="status_id" required="false" type="INTEGER"/>
  	<column name="currency_id" required="false" type="INTEGER"/>
  	<column name="create_datetime" required="true" type="TIMESTAMP"/>
  	<column name="last_status_change" required="false" type="TIMESTAMP"/>
  	<column name="last_login" required="false" type="TIMESTAMP"/>
  	
    <foreign-key foreignTable="language">
    	<reference foreign="id" local="language_id"/>
    </foreign-key>
     <foreign-key foreignTable="entity">
    	<reference foreign="id" local="entity_id"/>
    </foreign-key>
    <foreign-key foreignTable="user_status">
    	<reference foreign="id" local="status_id"/>
    </foreign-key>
    <foreign-key foreignTable="currency">
    	<reference foreign="id" local="currency_id"/>
    </foreign-key>
 
    <index>
       <index-column name="user_name"/>
    </index>
    <index>
       <index-column name="entity_id"/>
       <index-column name="deleted"/>
    </index>

  </table>
  
  
  <table name="user_status" description="A user can be in different status">
  	   <column name="id" required="true" primaryKey="true" type="INTEGER" />
  	   <column name="can_login" required="true" type="BOOLEANINT"/>
  	   <!-- description is international -->
  </table>
  
  <table name="customer" description="A user that buys items, gets invoices and pays">
	  <column name="id" required="true" primaryKey="true" type="INTEGER"/>
	  <column name="user_id" required="false" type="INTEGER"/>
	  <column name="partner_id" required="false" type="INTEGER"/>
	  <column name="referral_fee_paid" required="false" type="BOOLEANINT"/>
	  <column name="invoice_delivery_method_id" required="true" type="INTEGER"/>
	  <column name="notes" required="false" type="VARCHAR" size="1000"/>
	  <column name="auto_payment_type" required="false" type="INTEGER"
	  	  description="If the customer will pay automaticaly, how (cc/ach)"/>
	   
    <foreign-key foreignTable="base_user">
    	<reference foreign="id" local="user_id"/>
    </foreign-key>
    <foreign-key foreignTable="partner">
    	<reference foreign="id" local="partner_id"/>
    </foreign-key>
    <foreign-key foreignTable="invoice_delivery_method">
    	<reference foreign="id" local="invoice_delivery_method_id"/>
    </foreign-key>
    <index>
       <index-column name="user_id"/>
    </index>
  </table>

  <table name="partner" description="A user that 'owns' other users">
	  <column name="id" required="true" primaryKey="true" type="INTEGER" />
	  <column name="user_id" required="false" type="INTEGER"/>
	  <column name="balance" required="true" type="FLOAT"/>
	  <column name="total_payments" required="true" type="FLOAT"/>
	  <column name="total_refunds" required="true" type="FLOAT"/>
	  <column name="total_payouts" required="true" type="FLOAT"/>
	  <column name="percentage_rate" required="false" type="FLOAT"/>
	  <column name="referral_fee" required="false" type="FLOAT"/>
	  <column name="fee_currency_id" required="false" type="INTEGER"/>	  
	  <column name="one_time" required="true" type="BOOLEANINT"/>
	  <column name="period_unit_id" required="true" type="INTEGER"/>
	  <column name="period_value" required="true" type="INTEGER"/>
	  <column name="next_payout_date" required="true" type="DATE"/>
	  <column name="due_payout" required="false" type="FLOAT"/>
	  <column name="automatic_process" required="true" type="BOOLEANINT"/>
	  <column name="related_clerk" required="false" type="INTEGER"/>
	  	  	   
    <foreign-key foreignTable="base_user">
    	<reference foreign="id" local="user_id"/>
    </foreign-key>
    <foreign-key foreignTable="base_user">
    	<reference foreign="id" local="related_clerk"/>
    </foreign-key>
    <foreign-key foreignTable="currency">
    	<reference foreign="id" local="fee_currency_id"/>
    </foreign-key>
	<foreign-key foreignTable="period_unit">
		<reference foreign="id" local="period_unit_id"/>
	</foreign-key>
     <index>
       <index-column name="user_id"/>
    </index>
     <index>
       <index-column name="next_payout_date"/>
    </index>
  </table>

  <table name="partner_payout">
  	 <column name="id" required="true" primaryKey="true" type="INTEGER"/>
   	 <column name="starting_date" required="true" type="DATE" />
  	 <column name="ending_date" required="true" type="DATE" />
  	 <column name="payments_amount" required="true" type="FLOAT" />
  	 <column name="refunds_amount" required="true" type="FLOAT" />
  	 <column name="balance_left" required="true" type="FLOAT" />
  	 <column name="payment_id" required="false" type="INTEGER" />
  	 <column name="partner_id" required="false" type="INTEGER" />

     <foreign-key foreignTable="partner">
        <reference foreign="id" local="partner_id"/>
     </foreign-key> 
     <foreign-key foreignTable="payment">
        <reference foreign="id" local="payment_id"/>
     </foreign-key> 
     <index>
       <index-column name="partner_id"/>
     </index>
  </table>
  
  <table name="item" description="Articles, products, services table">
  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	<column name="internal_number" required="false" type="VARCHAR" size="50" />
    <column name="entity_id" required="false" type="INTEGER"/>
  	<column name="percentage" required="false" type="FLOAT" 
  			description="only relevant when price_precentage=true"/>
  	<column name="price_manual" required="true" type="BOOLEANINT"/>
    <column name="deleted" required="true" default="0" type="BOOLEANINT"/>
    <!--  description is international -->	 
  	
  	<foreign-key foreignTable="entity">
    	<reference foreign="id" local="entity_id"/>
    </foreign-key>
  </table>
  
  <table name="item_type_map" description="allows for an item to belong to multiple types">
  	<column name="item_id" required="false" type="INTEGER"/>
  	<column name="type_id" required="false" type="INTEGER"/>  		

  	<foreign-key foreignTable="item_type">
    	<reference foreign="id" local="type_id"/>
    </foreign-key>
  	<foreign-key foreignTable="item">
    	<reference foreign="id" local="item_id"/>
    </foreign-key>
  </table>
  
  <table name="item_price" description="allows for prices in different currencies">
  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	<column name="item_id" required="false" type="INTEGER"/>
  	<column name="currency_id" required="false" type="INTEGER"/>
  	<column name="price" required="true" type="FLOAT" />

  	<foreign-key foreignTable="item">
    	<reference foreign="id" local="item_id"/>
    </foreign-key>
  	<foreign-key foreignTable="currency">
    	<reference foreign="id" local="currency_id"/>
    </foreign-key>
  </table>
  
  <table name="item_type" description="Groups items">
	 <column name="id" required="true" primaryKey="true" type="INTEGER"/>  	
     <column name="entity_id" required="true" type="INTEGER"/>
 	 <!-- description is international -->	 

  	<foreign-key foreignTable="entity">
    	<reference foreign="id" local="entity_id"/>
    </foreign-key>
  </table>
  
  <table name="item_user_price" description="allows for users to have special prices">
  	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
	    <column name="item_id" required="false" type="INTEGER" />
        <column name="user_id" required="false" type="INTEGER" />
        <column name="price" required="true" type="FLOAT"/>
        <column name="currency_id" required="true" type="INTEGER" />

  	<foreign-key foreignTable="item">
    	<reference foreign="id" local="item_id"/>
    </foreign-key>
    <foreign-key foreignTable="base_user">
    	<reference foreign="id" local="user_id"/>
    </foreign-key> 
    <foreign-key foreignTable="currency">
    	<reference foreign="id" local="currency_id"/>
    </foreign-key> 
    
    <index>
    	<index-column name="user_id"/>
    	<index-column name="item_id"/>
    </index>
   </table>
   
   <table name="promotion" description="a key asosiated with an item">
   	    <column name="id" required="true" primaryKey="true" type="INTEGER"/>
   	    <column name="item_id" required="false" type="INTEGER" />
   	    <column name="code" required="true" type="VARCHAR" size="50"/>
   	    <column name="notes" required="false" type="VARCHAR" size="200"/>
   	    <column name="once" required="true" type="BOOLEANINT"/>
   	    <column name="since" required="false" type="DATE"/>
   	    <column name="until" required="false" type="DATE"/>   	    

		<foreign-key foreignTable="item">
			<reference foreign="id" local="item_id"/>
		</foreign-key>
        <index name="ix_promotion_code">
    	    <index-column name="code"/>
        </index>
   </table>
   
   <table name="promotion_user_map" description="indicates if a user has used a promotion or not">
   	    <column name="user_id" required="false" type="INTEGER"/>
   	    <column name="promotion_id" required="false" type="INTEGER"/>

		<foreign-key foreignTable="promotion">
			<reference foreign="id" local="promotion_id"/>
		</foreign-key>
		<foreign-key foreignTable="base_user">
			<reference foreign="id" local="user_id"/>
		</foreign-key>
       <index>
          <index-column name="user_id"/>
          <index-column name="promotion_id"/>       
       </index>
   </table>
  
  <table name="purchase_order" description="Orders table">
  	
  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
    <column name="user_id" required="false" type="INTEGER" description="who is buying/is going to pay this order"/>
    <column name="period_id" required="false" type="INTEGER"/>
    <column name="billing_type_id" required="true" type="INTEGER" 
    	description="is this order going to be paid in advance or after it's been delivered"/>
    <column name="active_since" required="false" type="DATE"/>
    <column name="active_until" required="false" type="DATE"/>
  	<column name="create_datetime" required="true" type="TIMESTAMP"/>
  	<column name="next_billable_day" required="false" type="TIMESTAMP"
  		description="the first unpaid day of this order"/>
   	<column name="created_by" required="true" type="INTEGER"/>
    <column name="status_id" required="true" type="INTEGER"/>
  	<column name="currency_id" required="true" type="INTEGER"/>
  	<column name="notify" required="false" type="BOOLEANINT"/>
  	<column name="last_notified" required="false" type="TIMESTAMP"/>
  	<column name="notification_step" required="false" type="INTEGER"/>
   	<column name="deleted" required="true" default="0" type="BOOLEANINT"/>
  	
    <foreign-key foreignTable="base_user">
    	<reference foreign="id" local="created_by"/>
    </foreign-key> 
    <foreign-key foreignTable="base_user">
    	<reference foreign="id" local="user_id"/>
    </foreign-key> 
  	<foreign-key foreignTable="order_period">
    	<reference foreign="id" local="period_id"/>
    </foreign-key>
  	<foreign-key foreignTable="order_billing_type">
    	<reference foreign="id" local="billing_type_id"/>
    </foreign-key>
  	<foreign-key foreignTable="currency">
    	<reference foreign="id" local="currency_id"/>
    </foreign-key>
  	<foreign-key foreignTable="order_status">
    	<reference foreign="id" local="status_id"/>
    </foreign-key>

	 <index>
		 <index-column name="user_id"/>
		 <index-column name="deleted"/>		 
	 </index>

	 <index>
		 <index-column name="active_until"/>
		 <index-column name="notification_step"/>		 
	 </index>     
  </table>

  <table name="order_billing_type" 
 		description="Indicates if an order will be payable in advance, after service, etc ... ">
 		
  	<column name="id" required="true" primaryKey="true" type="INTEGER"/> 		
    <!-- description is international-->
  </table>
  
  <table name="order_status" 
 		description="Indicates if an order is active or in some other status">
 		
  	<column name="id" required="true" primaryKey="true" type="INTEGER"/> 		
    <!-- description is international-->
  </table>

  <table name="order_line" description="Each of the items that compose an order">
  	
  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
    <column name="order_id" required="false" type="INTEGER"/>
    <column name="item_id" required="false" type="INTEGER"/>
    <column name="type_id" required="false" type="INTEGER"/>    
    <column name="description" required="true" type="VARCHAR" size="100"/>
    <column name="amount" required="true" type="FLOAT"/>
    <column name="quantity" required="false" type="INTEGER"/>
    <column name="price" required="false" type="FLOAT"/>
    <column name="item_price" required="false" type="BOOLEANINT" 
    	description="This flags indicates if the item of this line is linked to the item or is independent"/>
    <column name="create_datetime" required="true" type="TIMESTAMP"/>
    <column name="deleted" required="true" default="0" type="BOOLEANINT"/>
  	
  	<foreign-key foreignTable="purchase_order">
    	<reference foreign="id" local="order_id"/>
    </foreign-key>
  	<foreign-key foreignTable="item">
    	<reference foreign="id" local="item_id"/>
    </foreign-key>
    <foreign-key foreignTable="order_line_type">
    	<reference foreign="id" local="type_id"/>
    </foreign-key>
  </table>
 
 <table name="order_period" description="States a period of time, or one time">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
 	  	<column name="entity_id" required="false" type="INTEGER"/>
 	  	<column name="value" required="false" type="INTEGER"/>
 	  	<column name="unit_id" required="false" type="INTEGER"/>
 	    
 	    <foreign-key foreignTable="period_unit">
    		<reference foreign="id" local="unit_id"/>
	    </foreign-key>
        <foreign-key foreignTable="entity">
           <reference foreign="id" local="entity_id"/>
        </foreign-key>
  </table>
  
  <table name="period_unit" description="Describes the time unit">
   	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
  </table>
 
  <table name="order_line_type" description="Taxes, items, etc">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
 	    <column name="editable" required="true" type="BOOLEANINT"/>
  </table>
  
  <table name="pluggable_task" 
  	 description="Classes that will be applied to some process depending the entity configuration">
  	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	 	<column name="entity_id" required="true" type="INTEGER"/>
  	 	<column name="type_id" required="true" type="INTEGER"/>
  	 	<column name="processing_order" required="true" type="INTEGER"	
  	 		description="In which order this rule is applied"/>
  	 		
  	   	<foreign-key foreignTable="entity">
    		<reference foreign="id" local="entity_id"/>
        </foreign-key>
  	   	<foreign-key foreignTable="pluggable_task_type">
    		<reference foreign="id" local="type_id"/>
        </foreign-key>
  </table>
  
  <table name="pluggable_task_type">
  	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	  	<column name="category_id" required="true"  type="INTEGER"/>  	  	
  	 	<column name="class_name" required="true" type="VARCHAR" size="200"/>  
  	 	<column name="min_parameters" required="true" type="INTEGER" />
  	 	
  	 	<foreign-key foreignTable="pluggable_task_type_category">
    		<reference foreign="id" local="category_id"/>
        </foreign-key>
  </table>  	 	

  <table name="pluggable_task_type_category">
  	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	  	<column name="description" required="true" type="VARCHAR" size="30" />
  	 	<column name="interface_name" required="true" type="VARCHAR" size="200"/>    	 	
  </table>
  
  <table name="pluggable_task_parameter">
  	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	  	<column name="task_id" required="true" type="INTEGER"/>
  	  	<column name="name" required="true" type="VARCHAR" size="50"/>
  	  	<column name="int_value" required="false" type="INTEGER" />
  	  	<column name="str_value" required="false" type="VARCHAR" size="200" />
  	  	<column name="float_value" required="false" type="FLOAT" />
  	  	
 	   	<foreign-key foreignTable="pluggable_task">
    		<reference foreign="id" local="task_id"/>
        </foreign-key>
  </table>
  
  <table name="invoice" description="All the invoices">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	    <column name="create_datetime" required="true" type="TIMESTAMP"/>
  	    <column name="billing_process_id" required="false" type="INTEGER"/>
  	    <column name="user_id" required="false" type="INTEGER"/>
  	    <column name="delegated_invoice_id" required="false" type="INTEGER"
  	    	description="To which other invoice this one was carried because of lack of payment"/>
  	    <column name="due_date" required="true" type="DATE"/>
  	    <column name="total" required="true" type="FLOAT"/>
        <column name="payment_attempts" required="true" type="INTEGER" default="0"/>
  	    <column name="to_process" required="true" default="1" type="BOOLEANINT"/>  	    
  	    <column name="balance" required="false" type="FLOAT"/>
   	    <column name="carried_balance" required="true" type="FLOAT"
   	    	description="How much is being carried from previously unpaid invoices"/>
  	    <column name="in_process_payment" required="true" default="1" type="BOOLEANINT"/>
  	    <column name="is_review" required="true" type="INTEGER"/>
  	    <column name="currency_id" required="true" type="INTEGER"/>
  	    <column name="deleted" required="true" default="0" type="BOOLEANINT"/>
  	    <column name="paper_invoice_batch_id" required="false" type="INTEGER"/>
  	    <column name="customer_notes" required="false" type="VARCHAR" size="1000"/>
  	    <column name="public_number" required="false" type="VARCHAR" size="40"/>
  	    
    <foreign-key foreignTable="paper_invoice_batch">
    	<reference foreign="id" local="paper_invoice_batch_id"/>
    </foreign-key> 
  	<foreign-key foreignTable="billing_process">
    	<reference foreign="id" local="billing_process_id"/>
    </foreign-key>
   	<foreign-key foreignTable="base_user">
    	<reference foreign="id" local="user_id"/>
    </foreign-key>
   	<foreign-key foreignTable="invoice">
    	<reference foreign="id" local="delegated_invoice_id"/>
    </foreign-key>
   	<foreign-key foreignTable="currency">
    	<reference foreign="id" local="currency_id"/>
    </foreign-key>
  	    
  </table>

   
  <table name="invoice_line" description="Each of the lines that compose an invoice">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	    <column name="invoice_id" required="false" type="INTEGER"/> 
  	    <column name="type_id" required="true" type="INTEGER"/>
  	    <column name="item_id" required="false" type="INTEGER"
  	    	description="The item that originated this invoice, even if later it could change"/>
 	    <column name="description" required="true" type="VARCHAR" size="100"/>
    	<column name="amount" required="true" type="FLOAT"/>
    	<column name="quantity" required="false" type="INTEGER"/>
    	<column name="price" required="false" type="FLOAT"/>
    	<column name="deleted" required="true" default="0" type="BOOLEANINT"/>
 
   	<foreign-key foreignTable="invoice">
    	<reference foreign="id" local="invoice_id"/>
    </foreign-key>
   	<foreign-key foreignTable="item">
    	<reference foreign="id" local="item_id"/>
    </foreign-key>
   	<foreign-key foreignTable="invoice_line_type">
    	<reference foreign="id" local="type_id"/>
    </foreign-key>
   </table>
   
   <table name="invoice_line_type" description="items, taxes, interests, previous balance ...">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
 	  	<column name="description" required="true" type="VARCHAR" size="50"/>
   </table>
   
   <table name="invoice_delivery_method">
        <column name="id" required="true" primaryKey="true" type="INTEGER"/>
		<!-- description is international -->
   </table>
 
   <table name="entity_delivery_method_map" description="which methods an entity is going to use">
  	<column name="method_id" required="false" type="INTEGER"/>
  	<column name="entity_id" required="false" type="INTEGER"/>  		

  	<foreign-key foreignTable="invoice_delivery_method">
    	<reference foreign="id" local="method_id"/>
    </foreign-key>
  	<foreign-key foreignTable="entity">
    	<reference foreign="id" local="entity_id"/>
    </foreign-key>
  </table>
   
  <table name="order_process" 
  		description="a process of an order. Also represents the many-to-many relationship between purchase_order and invoice, and between orders and billing_process">
  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>  	
  	<column name="order_id" required="false" type="INTEGER"/>
  	<column name="invoice_id" required="false" type="INTEGER"/>
    <column name="billing_process_id" required="false" type="INTEGER"/>  	
    <column name="periods_included" required="false" type="INTEGER"/>
  	<column name="period_start" required="false" type="DATE"/>
  	<column name="period_end" required="false" type="DATE"/>
  	<column name="is_review" required="true" type="INTEGER"/>
  	<column name="origin" required="false" type="INTEGER" 
  		description="A code that describes how an order was included in an invoice"/>
  	
   	<foreign-key foreignTable="purchase_order">
    	<reference foreign="id" local="order_id"/>
    </foreign-key>
   	<foreign-key foreignTable="invoice">
    	<reference foreign="id" local="invoice_id"/>
    </foreign-key>
    <foreign-key foreignTable="billing_process">
    	<reference foreign="id" local="billing_process_id"/>
    </foreign-key> 
    
    <index name="ix_uq_order_process_or_in">
    	<index-column name="order_id"/>
    	<index-column name="invoice_id"/>
    </index>
    <index name="ix_uq_order_process_or_bp">
    	<index-column name="order_id"/>
    	<index-column name="billing_process_id"/>
    </index>
    <index>
    	<index-column name="invoice_id"/>
    </index>
  </table>
   
  <table name="billing_process" description="The run of a billing cycle">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	    <column name="entity_id" required="true" type="INTEGER"/>
  	    <column name="billing_date" required="true" type="DATE" />
  	    <column name="period_unit_id" required="true" type="INTEGER"/>
  	    <column name="period_value" required="true" type="INTEGER"/>
  	    <column name="is_review" required="true" type="INTEGER"/>
  	    <column name="paper_invoice_batch_id" required="false" type="INTEGER"/>
  	    
    <foreign-key foreignTable="paper_invoice_batch">
    	<reference foreign="id" local="paper_invoice_batch_id"/>
    </foreign-key> 
  	<foreign-key foreignTable="entity">
    	<reference foreign="id" local="entity_id"/>
    </foreign-key> 
 	<foreign-key foreignTable="period_unit">
    	<reference foreign="id" local="period_unit_id"/>
    </foreign-key> 
    
  </table>

  <table name="billing_process_run" description="A try of a run of a billing process">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	    <column name="process_id" required="false" type="INTEGER"/>
  	    <column name="run_date" required="true" type="DATE"/>
  	    <column name="started" required="true" type="TIMESTAMP"/>
  	    <column name="finished" required="false" type="TIMESTAMP"/>
  	    <column name="invoices_generated" required="false" type="INTEGER"/>

  	<foreign-key foreignTable="billing_process">
    	<reference foreign="id" local="process_id"/>
    </foreign-key> 
  </table>

  <table name="billing_process_run_total">
  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	<column name="process_run_id" required="false" type="INTEGER"/>
  	<column name="currency_id" required="true" type="INTEGER"/>
    <column name="total_invoiced" required="false" type="FLOAT"/>
    <column name="total_paid" required="false" type="FLOAT"/>
    <column name="total_not_paid" required="false" type="FLOAT"/>

  	<foreign-key foreignTable="billing_process_run">
    	<reference foreign="id" local="process_run_id"/>
    </foreign-key> 
	<foreign-key foreignTable="currency">
	  <reference foreign="id" local="currency_id"/>
    </foreign-key> 
  </table>

  <table name="billing_process_run_total_pm">
  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	<column name="process_run_total_id" required="false" type="INTEGER"/>
  	<column name="payment_method_id" required="false" type="INTEGER"/>
  	<column name="total" required="true" type="FLOAT"/>

  	<foreign-key foreignTable="payment_method">
    	<reference foreign="id" local="payment_method_id"/>
    </foreign-key> 
  </table>  
  
  <table name="billing_process_configuration">
  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
    <column name="entity_id" required="false" type="INTEGER"/>
	<column name="next_run_date" required="true" type="DATE"/>		
	<column name="generate_report" required="true" type="BOOLEANINT"/>
    <column name="retries" required="false" type="INTEGER"/> 	  	
    <column name="days_for_retry" required="false" type="INTEGER"/> 	  	
    <column name="days_for_report" required="false" type="INTEGER"/>
    <column name="review_status" required="true" type="INTEGER"/>
    <column name="period_unit_id" required="true" type="INTEGER"/>
	<column name="period_value" required="true" type="INTEGER"/>
	<column name="days_due_date" required="true" type="INTEGER"/>
  	    
 	<foreign-key foreignTable="period_unit">
    	<reference foreign="id" local="period_unit_id"/>
    </foreign-key> 
  	<foreign-key foreignTable="entity">
    	<reference foreign="id" local="entity_id"/>
    </foreign-key> 
  </table>
  
  <table name="paper_invoice_batch">
  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	<column name="total_invoices" required="true" type="INTEGER"/>
  	<column name="delivery_date" required="false" type="DATE"/>
  	<column name="is_self_managed" required="true" type="BOOLEANINT"/>
 
  </table>
  
  <table name="payment" description="Payments">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
 	  	<column name="user_id" required="false" type="INTEGER"/>
	    <column name="attempt" required="false" type="INTEGER"/> 	  	
	    <column name="result_id" required="false" type="INTEGER"/>
 	  	<column name="amount" required="true" type="FLOAT"/>
		<column name="create_datetime" required="true" type="TIMESTAMP"/>
		<column name="payment_date" required="false" type="DATE"/>		
		<column name="method_id" required="true" type="INTEGER"/>
		<column name="credit_card_id" required="false" type="INTEGER"/>
		<column name="ach_id" required="false" type="INTEGER"/>
		<column name="deleted" required="true" default="0" type="BOOLEANINT"/>
		<column name="is_refund" required="true" default="0" type="BOOLEANINT"/>
		<column name="payment_id" required="false" type="INTEGER"/>
  	    <column name="currency_id" required="true" type="INTEGER"/>
   	    <column name="payout_id" required="false" type="INTEGER"/>
		
    <foreign-key foreignTable="base_user">
    	<reference foreign="id" local="user_id"/>
    </foreign-key> 
    <foreign-key foreignTable="payment_method">
    	<reference foreign="id" local="method_id"/>
    </foreign-key> 
    <foreign-key foreignTable="payment_result">
    	<reference foreign="id" local="result_id"/>
    </foreign-key> 
	<foreign-key foreignTable="credit_card">
	  <reference foreign="id" local="credit_card_id"/>
    </foreign-key> 
	<foreign-key foreignTable="ach">
	  <reference foreign="id" local="ach_id"/>
    </foreign-key> 
	<foreign-key foreignTable="payment">
	  <reference foreign="id" local="payment_id"/>
    </foreign-key> 
	<foreign-key foreignTable="currency">
	  <reference foreign="id" local="currency_id"/>
    </foreign-key> 
    
    <index>
    	<index-column name="user_id"/>
    	<index-column name="create_datetime"/>
    </index>
   </table>
 

   <table name="payment_info_cheque" description="Cheque information related to a payment">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
 	  	<column name="payment_id" required="false" type="INTEGER"/> 	  	
	    <column name="bank" required="false" type="VARCHAR" size="50"/>
	    <column name="cheque_number" required="false" type="VARCHAR" size="50" />
	    <column name="cheque_date" required="false" type="DATE"/>

       <foreign-key foreignTable="payment">
    	  <reference foreign="id" local="payment_id"/>
       </foreign-key> 
   </table>  
   
   <table name="payment_authorization" description="Credit card transaction information">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
 	  	<column name="payment_id" required="false" type="INTEGER"/> 	  	
 	  	<column name="processor" required="true" type="VARCHAR" size="20"/>
 	  	<column name="code1" required="true" type="VARCHAR" size="20"/>
 	  	<column name="code2" required="false" type="VARCHAR" size="20"/>
 	  	<column name="code3" required="false" type="VARCHAR" size="20"/> 	  	 	  	
 	  	<column name="approval_code" required="false" type="VARCHAR" size="20"/>
 	  	<column name="avs" required="false" type="VARCHAR" size="20"/> 	  	 	  	
 	  	<column name="transaction_id" required="false" type="VARCHAR" size="20"/> 	  	 	  	
 	  	<column name="md5" required="false" type="VARCHAR" size="100"/> 	  	 	  	
 	  	<column name="card_code" required="false" type="VARCHAR" size="20"/> 	  	 	  	
 	  	<column name="create_datetime" required="true" type="DATE"/> 	  	 	  	 	  	
   
       <foreign-key foreignTable="payment">
    	  <reference foreign="id" local="payment_id"/>
       </foreign-key> 
   </table>

   <table name="credit_card" description="credit card information">	  	
	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>   	
 	  	<column name="cc_number" required="true" type="VARCHAR" size="30"/> 	  	
	    <column name="cc_expiry" required="true" type="DATE" />
	    <column name="name" required="false" type="VARCHAR" size="50" />
	    <column name="cc_type" required="true" type="INTEGER"/>
	    <column name="deleted" required="true" default="0" type="BOOLEANINT"/>
   </table>  

   <table name="user_credit_card_map" 
  		description="maps a user to many credit cards">
		  <column name="user_id" required="false" type="INTEGER"/>
		  <column name="credit_card_id" required="false" type="INTEGER"/>
		  
		<foreign-key foreignTable="base_user">
			<reference foreign="id" local="user_id"/>
		</foreign-key>
		   <foreign-key foreignTable="credit_card">
			<reference foreign="id" local="credit_card_id"/>
		</foreign-key>
		
		<index >
			<index-column name="user_id"/>
			<index-column name="credit_card_id"/>
		</index>
   </table>
   
   <table name="ach" description="information for direct debit">
        <column name="id" required="true" primaryKey="true" type="INTEGER"/>
        <column name="user_id" required="false" type="INTEGER"/>
        <column name="aba_routing" required="true" type="VARCHAR" size="9" />
        <column name="bank_account" required="true" type="VARCHAR" size="20" />
        <column name="account_type" required="true" type="INTEGER" />
        <column name="bank_name" required="true" type="VARCHAR" size="50" />
        <column name="account_name" required="true" type="VARCHAR" size="100" />     
        
        <foreign-key foreignTable="base_user">
			<reference foreign="id" local="user_id"/>
		</foreign-key>
		
		<index>
			<index-column name="user_id"/>
		</index>   
   </table>

   <table name="payment_result">
   		<column name="id" required="true" primaryKey="true" type="INTEGER"/>
   </table>
  
    <table name="payment_invoice_map" 
  		description="maps the many-to-many relationship between payments and invoices">
  	<column name="payment_id" required="false" type="INTEGER"/>
  	<column name="invoice_id" required="false" type="INTEGER"/>
  	
   	<foreign-key foreignTable="payment">
    	<reference foreign="id" local="payment_id"/>
    </foreign-key>
   	<foreign-key foreignTable="invoice">
    	<reference foreign="id" local="invoice_id"/>
    </foreign-key>
    
    <index name="ix_uq_payment_invoice_map_pa_in">
    	<index-column name="payment_id"/>
    	<index-column name="invoice_id"/>
    </index>
  </table>
  
  
   <table name="payment_method" description="How a payment can be done">
	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
	  	<!-- description is international-->
   </table>
  
  <table name="entity_payment_method_map"
  	  description="defines which payment methdos are available for an entity">
  	<column name="entity_id" required="false" type="INTEGER"/>
  	<column name="payment_method_id" required="false" type="INTEGER"/>
  	
   	<foreign-key foreignTable="entity">
    	<reference foreign="id" local="entity_id"/>
    </foreign-key>
   	<foreign-key foreignTable="payment_method">
    	<reference foreign="id" local="payment_method_id"/>
    </foreign-key>
    
    <index name="ix_uq_entity_payment_method_map">
    	<index-column name="entity_id"/>
    	<index-column name="payment_method_id"/>
    </index>
  </table>
  
  <!-- Make sure the country code follows the iso  ISO-3166 -->
  <table name="contact" description="Information of an individual">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
 	  	<column name="ORGANIZATION_NAME" required="false" type="VARCHAR" size="200"/>
 	  	<column name="STREET_ADDRES1" required="false" type="VARCHAR" size="100"/>                 
 	  	<column name="STREET_ADDRES2" required="false" type="VARCHAR" size="100"/>                 
 	  	<column name="CITY" required="false" type="VARCHAR" size="50"/>                           
 	  	<column name="STATE_PROVINCE" required="false" type="VARCHAR" size="30"/>                 
 	  	<column name="POSTAL_CODE" required="false" type="VARCHAR" size="15"/>                    
 	  	<column name="COUNTRY_CODE" required="false" type="VARCHAR" size="2"/>                   
 	  	<column name="LAST_NAME" required="false" type="VARCHAR" size="30"/>                      
 	  	<column name="FIRST_NAME" required="false" type="VARCHAR" size="30"/>                     
 	  	<column name="PERSON_INITIAL" required="false" type="VARCHAR" size="5"/>                 
 	  	<column name="PERSON_TITLE" required="false" type="VARCHAR" size="40"/>                   
 	  	<column name="PHONE_COUNTRY_CODE" required="false" type="INTEGER"/>       
 	  	<column name="PHONE_AREA_CODE" required="false" type="INTEGER" />                
 	  	<column name="PHONE_PHONE_NUMBER" required="false" type="VARCHAR" size="20"/>             
 	  	<column name="FAX_COUNTRY_CODE" required="false" type="INTEGER" />         
 	  	<column name="FAX_AREA_CODE" required="false" type="INTEGER" />                  
 	  	<column name="FAX_PHONE_NUMBER" required="false" type="VARCHAR" size="20"/>              
 	  	<column name="EMAIL" required="false" type="VARCHAR" size="200"/>                          
 	  	<column name="CREATE_DATETIME" required="true" type="TIMESTAMP" />
 	  	<column name="notification_include" required="false" type="BOOLEANINT" />
 	  	<column name="deleted" required="true" default="0" type="BOOLEANINT"/>   

		<index>
			<index-column name="deleted"/>
		</index>
  </table>
  
  
  <table name="contact_map" description="Allows to have more than one contact per user">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
		<column name="contact_id" required="false" type="INTEGER"/>
 	  	<column name="type_id" required="true" type="INTEGER"/>
 	  	<column name="table_id" required="true" type="INTEGER"/>
 	  	<column name="foreign_id" required="true" type="INTEGER"/>
 	  	
    <foreign-key foreignTable="contact">
    	<reference foreign="id" local="contact_id"/>
    </foreign-key> 	  	
   <foreign-key foreignTable="contact_type">
    	<reference foreign="id" local="type_id"/>
    </foreign-key> 
    <foreign-key foreignTable="betty_table">
    	<reference foreign="id" local="table_id"/>
    </foreign-key> 
    
    <unique>
    	<unique-column name="contact_id"/>
    </unique>
    <unique name="ix_contact_map_fo">
    	<unique-column name="foreign_id"/>
     	<unique-column name="table_id"/>
     	<unique-column name="type_id"/>
    </unique>
  </table>


  <table name="contact_type" description="Restricts how many types of contacts there are">
  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
    <column name="entity_id" required="false" type="INTEGER"/>
    <column name="is_primary" required="false" type="BOOLEANINT"/>

  	<!-- Description is international -->
    <foreign-key foreignTable="entity">
    	<reference foreign="id" local="entity_id"/>
    </foreign-key> 
  </table>
  
  <table name="contact_field_type" description="Per-entity contact fields">
  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	<column name="entity_id" required="false" type="INTEGER"/>
  	<column name="prompt_key" required="true" type="VARCHAR" size="50"/>
  	<column name="data_type" required="true" type="VARCHAR" size="10"/>
  	
  	<foreign-key foreignTable="entity">
    	<reference foreign="id" local="entity_id"/>
    </foreign-key>
  </table>
  
  <table name="contact_field" description="The content of a per-entity field">
  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	<column name="type_id" required="false" type="INTEGER"/>
  	<column name="contact_id" required="false" type="INTEGER"/>
  	<column name="content" required="true" type="VARCHAR" size="100"/>
  	
  	<foreign-key foreignTable="contact_field_type">
    	<reference foreign="id" local="type_id"/>
    </foreign-key>
    <foreign-key foreignTable="contact">
    	<reference foreign="id" local="contact_id"/>
    </foreign-key>
  </table>
  
  <table name="betty_table" description="Tables of the application">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
	    <column name="name" required="true" type="VARCHAR" size="50"/>
   	  	<column name="next_id" required="true" default="0" type="INTEGER"/>
   	  	
   	  	<index>
   	  		<index-column name="name"/>
   	  	</index>
  </table>
  
  <table name="betty_table_column" description="Columns of the tables of the application">
 	  	<column name="table_id" required="true" primaryKey="true" type="INTEGER"/>  	
  	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>
	    <column name="name" required="true" type="VARCHAR" size="50"/>
  	  	
   	    <foreign-key foreignTable="betty_table">
     		<reference foreign="id" local="table_id"/>
	    </foreign-key> 
  </table>
  
  <table name="international_description" description="descriptions that are language sensitive">
 	  	<column name="table_id" required="true" primaryKey="true" type="INTEGER"/>
 	  	<column name="foreign_id" required="true" primaryKey="true" type="INTEGER"/>
 	  	<column name="psudo_column" required="true" primaryKey="true" type="VARCHAR" size="20"/>
 	  	<column name="language_id" required="true" primaryKey="true" type="INTEGER"/>
 	  	<column name="content" required="true" type="VARCHAR" size="1000" 
 	  		description="This limit allows for DB compatibility"/>
 	  	
       <foreign-key foreignTable="betty_table">
            <reference foreign="id" local="table_id"/>
       </foreign-key> 
       <foreign-key foreignTable="language">
            <reference foreign="id" local="language_id"/>
       </foreign-key> 
       
       <index>
           <index-column name="table_id"/>
           <index-column name="foreign_id"/>
           <index-column name="language_id"/>
       </index>
       <index>
           <index-column name="language_id"/>
       </index>
  </table>
  
  <!-- Make sure all the codes follow the ISO-639 -->
  <table name="language" description="languages codes">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>  	
 	  	<column name="code" required="true" type="VARCHAR" size="2"/>
 	  	<column name="description" required="true" type="VARCHAR" size="50"/>
  </table>

  <table name="event_log" description="general repository for use-accessable logs">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>  	
  	    <column name="entity_id" required="false" type="INTEGER"/>
  		<column name="user_id" required="false" type="INTEGER"/>
  		<column name="table_id" required="false" type="INTEGER"/>
  	    <column name="foreign_id" required="true" type="INTEGER"/>
  	    <column name="create_datetime" required="true" type="TIMESTAMP"/>
  	    <column name="level" required="true" type="INTEGER"/>
  	    <column name="module_id" required="true" type="INTEGER"/>
  	    <column name="message_id" required="true" type="INTEGER"/>
  		<column name="old_num" required="false" type="INTEGER" />
  		<column name="old_str" required="false" type="VARCHAR" size="1000"/>
  		<column name="old_date" required="false" type="TIMESTAMP" />
  	    	
       <foreign-key foreignTable="entity">
    	    <reference foreign="id" local="entity_id"/>
       </foreign-key> 
       <foreign-key foreignTable="event_log_module">
    	    <reference foreign="id" local="module_id"/>
       </foreign-key> 
       <foreign-key foreignTable="event_log_message">
    	    <reference foreign="id" local="message_id"/>
       </foreign-key> 
   	    <foreign-key foreignTable="betty_table">
     		<reference foreign="id" local="table_id"/>
	    </foreign-key> 
  	    <foreign-key foreignTable="base_user">
     		<reference foreign="id" local="user_id"/>
	    </foreign-key> 
       
  </table>
  
  <table name="event_log_module" description="modules that group events">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>  	
 	  	<!-- Description is international -->
  </table>
  
   <table name="event_log_message" description="possible messages">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>  	
 	  	<!-- Description is international -->
  </table>
  
  <table name="preference" description="general preferences table">
  		<column name="id" required="true" primaryKey="true" type="INTEGER"/>  	
  	  	<column name="type_id" required="false"  type="INTEGER"/>
  	  	<column name="table_id" required="true"  type="INTEGER"/>
 	  	<column name="foreign_id" required="true" type="INTEGER"/>
 	  	<column name="int_value" required="false" type="INTEGER" />
  	  	<column name="str_value" required="false" type="VARCHAR" size="200" />
  	  	<column name="float_value" required="false" type="FLOAT" />
  
        <foreign-key foreignTable="betty_table">
            <reference foreign="id" local="table_id"/>
       </foreign-key> 
        <foreign-key foreignTable="preference_type">
            <reference foreign="id" local="type_id"/>
       </foreign-key> 
  		
  </table>

  <table name="preference_type">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>  	
 	  	<!-- Description is international -->
  </table>

  <table name="notification_message">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>  	
  	  	<column name="type_id" required="false"  type="INTEGER"/>
  	    <column name="entity_id" required="true" type="INTEGER"/>
   	    <column name="language_id" required="true" type="INTEGER"/>

       <foreign-key foreignTable="entity">
    	    <reference foreign="id" local="entity_id"/>
       </foreign-key> 
       <foreign-key foreignTable="notification_message_type">
            <reference foreign="id" local="type_id"/>
       </foreign-key> 
       <foreign-key foreignTable="language">
            <reference foreign="id" local="language_id"/>
       </foreign-key> 
  </table>  
 
  <table name="notification_message_type">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>  	
 	  	<column name="sections" required="true" type="INTEGER"/>
 	  	<!-- Description is international -->
  </table>

  <table name="notification_message_section" description="Represents the sections">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>  	
  	    <column name="message_id" required="false" type="INTEGER"/>
  	    <column name="section" required="false" type="INTEGER"/>

       <foreign-key foreignTable="notification_message">
    	    <reference foreign="id" local="message_id"/>
       </foreign-key> 

  </table>

<!--  This table is necessary to keep the content of messages with unlimited size and still 
	    providing DB independence. (some RDBMS have unlimited varchars, others not... ) -->
  <table name="notification_message_line" description="Holds the contents of messages">
 	  	<column name="id" required="true" primaryKey="true" type="INTEGER"/>  	
  	    <column name="message_section_id" required="false" type="INTEGER"/>
  	    <column name="content" required="true" type="VARCHAR" size="1000"/>  	    

       <foreign-key foreignTable="notification_message_section">
    	    <reference foreign="id" local="message_section_id"/>
       </foreign-key> 

  </table>

  <table name="notification_message_archive" description="history of messages sent">
       <column name="id" required="true" primaryKey="true" type="INTEGER"/>  	
       <column name="type_id" required="false"  type="INTEGER"/>       
       <column name="create_datetime" required="true" type="TIMESTAMP"/>
       <column name="user_id" required="false" type="INTEGER"/>
       <column name="result_message" required="false" type="VARCHAR" size="200"/>

      <foreign-key foreignTable="base_user">
    	  <reference foreign="id" local="user_id"/>
      </foreign-key> 
  </table> 

  <table name="notification_message_archive_line" description="Holds the contents of messages">
        <column name="id" required="true" primaryKey="true" type="INTEGER"/>  	
  	    <column name="message_archive_id" required="false" type="INTEGER"/>
   	    <column name="section" required="true" type="INTEGER"/>
  	    <column name="content" required="true" type="VARCHAR" size="1000"/>  	    

       <foreign-key foreignTable="notification_message_archive">
    	    <reference foreign="id" local="message_archive_id"/>
       </foreign-key> 
  </table>

  <table name="report" description="a report definition">
       <column name="id" required="true" primaryKey="true" type="INTEGER"/>  	
       <column name="titleKey" required="false"  type="VARCHAR" size="50"
       		description="struts keys are international"/>               
       <column name="instructionsKey" required="false"  type="VARCHAR" size="50"/>                      
       <column name="tables" required="true"  type="VARCHAR" size="1000"/>                      
       <column name="where_str" required="true"  type="VARCHAR" size="1000"/> 
       <column name="id_column" required="true" type="BOOLEANINT"/>                        
       <column name="link" required="false" type="VARCHAR" size="200"/>
  </table>

  <table name="report_user" description="a report criteria saved by a user to allow prepopulation">
 	  <column name="id" required="true" primaryKey="true" type="INTEGER"/>  	
       <column name="user_id" required="false" type="INTEGER"/>       
       <column name="report_id" required="false" type="INTEGER"/>       
       <column name="create_datetime" required="true" type="TIMESTAMP"/>      
       <column name="title" required="false"  type="VARCHAR" size="50"/>               

      <foreign-key foreignTable="base_user">
    	  <reference foreign="id" local="user_id"/>
      </foreign-key> 
      <foreign-key foreignTable="report">
    	  <reference foreign="id" local="report_id"/>
      </foreign-key> 
  </table>
  
  <table name="report_type">
  	  <column name="id" required="true" primaryKey="true" type="INTEGER"/>
      <column name="showable" required="true" type="BOOLEANINT"
      	   description="If the reports belonging to this type should be shown in the main list."/>       
  	  <!-- description is international-->
  </table>
  
  <table name="report_type_map">
    <column name="report_id" type="INTEGER" required="false"/>
    <column name="type_id" type="INTEGER" required="false"/>

      <foreign-key foreignTable="report">
    	  <reference foreign="id" local="report_id"/>
      </foreign-key> 
      <foreign-key foreignTable="report_type">
    	  <reference foreign="id" local="type_id"/>
      </foreign-key> 
  </table>
  
  <table name="report_entity_map">
       <column name="entity_id" required="false" type="INTEGER"/>       
       <column name="report_id" required="false" type="INTEGER"/>       

      <foreign-key foreignTable="entity">
    	  <reference foreign="id" local="entity_id"/>
      </foreign-key> 
      <foreign-key foreignTable="report">
    	  <reference foreign="id" local="report_id"/>
      </foreign-key> 
    <index>
       <index-column name="entity_id"/>
       <index-column name="report_id"/>       
    </index>
  </table>

   <table name="report_field" description="a column with all the behavior information">
	   <column name="id" required="true" primaryKey="true" type="INTEGER"/>  	
       <column name="report_id" required="false"  type="INTEGER"/>	   
       <column name="report_user_id" required="false"  type="INTEGER"/>	  
       <column name="position" required="true" type="INTEGER"/>        
	   <column name="table_name" required="true" type="VARCHAR" size="50"
	   		description="since it's just to generate the sql, linking it to betty_tables makes things worse"/>
	   <column name="column_name" required="true" type="VARCHAR" size="50"/>
   	   <column name="order_position" required="false" type="INTEGER"/>
   	   <column name="where_value" required="false" type="VARCHAR" size="50"/>
   	   <column name="title_key" required="false" type="VARCHAR" size="50"/>
   	   <column name="function" required="false" type="VARCHAR" size="10"
   	   	    description="an optional agregate function to apply to the column"/>   	   
	   <column name="is_grouped" required="true" type="BOOLEANINT"/>
	   <column name="is_shown" required="true" type="BOOLEANINT"/>	   
   	   <column name="data_type" required="true" type="VARCHAR" size="10"/>
   	   <column name="operator" required="false" type="VARCHAR" size="2"
   	   		description="when null the column is not included in the where"/>   	   
	   <!-- The following fields indicate if the user can interact with the behavior of this column -->
	   <column name="functionable" required="true" type="BOOLEANINT"/>		
	   <column name="selectable" required="true" type="BOOLEANINT"/>
   	   <column name="ordenable" required="true" type="BOOLEANINT"/>
   	   <column name="operatorable" required="true" type="BOOLEANINT"/>
   	   <column name="whereable" required="true" type="BOOLEANINT"/>

      <foreign-key foreignTable="report">
    	  <reference foreign="id" local="report_id"/>
      </foreign-key> 
      <!-- Can't have this when having the InitializeReports.java file
      <foreign-key foreignTable="report_user">
    	  <reference foreign="id" local="report_user_id"/>
      </foreign-key> 
      -->
   </table>

  <table name="permission">
  	  <column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	  <column name="type_id" required="true" type="INTEGER"/>
  	  <column name="foreign_id" required="false" type="INTEGER"/>  	  
  	  <!-- description is international-->
  	  <!-- title is international-->

      <foreign-key foreignTable="permission_type">
    	  <reference foreign="id" local="type_id"/>
      </foreign-key> 
  </table>
  
  <!-- this is an internal table, not shown to the user, so the description is not international -->
  <table name="permission_type">
  	  <column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	  <column name="description" required="true" type="VARCHAR" size="30"/>
  </table>

  <table name="role">
  	  <column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	  <!-- name is international-->
  	  <!-- description is international-->
  </table>

  <table name="permission_role_map">
       <column name="permission_id" required="false" type="INTEGER"/>       
       <column name="role_id" required="false" type="INTEGER"/>       

      <foreign-key foreignTable="permission">
    	  <reference foreign="id" local="permission_id"/>
      </foreign-key> 
      <foreign-key foreignTable="role">
    	  <reference foreign="id" local="role_id"/>
      </foreign-key> 
    <index>
       <index-column name="permission_id"/>
       <index-column name="role_id"/>       
    </index>
  </table>

  <table name="user_role_map">
       <column name="user_id" required="false" type="INTEGER"/>       
       <column name="role_id" required="false" type="INTEGER"/>       

      <foreign-key foreignTable="base_user">
    	  <reference foreign="id" local="user_id"/>
      </foreign-key> 
      <foreign-key foreignTable="role">
    	  <reference foreign="id" local="role_id"/>
      </foreign-key> 
    <index>
       <index-column name="user_id"/>
       <index-column name="role_id"/>       
    </index>
    <index>
       <index-column name="role_id"/>       
    </index>
  </table>

  <table name="permission_user">
       <column name="permission_id" required="false" type="INTEGER"/>       
       <column name="user_id" required="false" type="INTEGER"/>       
       <column name="is_grant" required="yes" type="BOOLEANINT"/>

      <foreign-key foreignTable="permission">
    	  <reference foreign="id" local="permission_id"/>
      </foreign-key> 
      <foreign-key foreignTable="base_user">
    	  <reference foreign="id" local="user_id"/>
      </foreign-key> 
    <index>
       <index-column name="user_id"/>       
    </index>
  </table>

  <table name="menu_option">
  	 <column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	 <column name="link" required="true" type="VARCHAR" size="100" />
  	 <column name="level" required="true" type="INTEGER" />
  	 <column name="parent_id" required="false" type="INTEGER" />

     <foreign-key foreignTable="menu_option">
   	    <reference foreign="id" local="parent_id"/>
     </foreign-key> 

  </table>
  
  <table name="country">
  	 <column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	 <column name="code" required="true" type="VARCHAR" size="2"/>
  	 <!-- description is international -->
  </table>
  
  <table name="currency">
  	 <column name="id" required="true" primaryKey="true" type="INTEGER"/>
  	 <column name="symbol" required="true" type="VARCHAR" size="10" 
  	 	 description="This is html ready, usually a unicode code with some plain texts"/>
  	 <column name="code" required="true" type="VARCHAR" size="3" />
  	 <column name="country_code" required="true" type="VARCHAR" size="2"
  	 	 description="This is better than country_id, because it doesn't change"/>
  	 <!-- description is international -->

  </table>
  
  <table name="currency_entity_map">
     <column name="currency_id" required="false" type="INTEGER"/>       
     <column name="entity_id" required="false" type="INTEGER"/>       

     <foreign-key foreignTable="currency">
   	    <reference foreign="id" local="currency_id"/>
     </foreign-key> 
     <foreign-key foreignTable="entity">
        <reference foreign="id" local="entity_id"/>
      </foreign-key> 
      <index>
        <index-column name="currency_id"/>
        <index-column name="entity_id"/>       
      </index>
  </table>
  
  <table name="currency_exchange" description="The conversion rate againt the US$">
  	 <column name="id" required="true" primaryKey="true" type="INTEGER"/>
     <column name="entity_id" required="false" type="INTEGER"/>       
     <column name="currency_id" required="false" type="INTEGER"/>       
     <column name="rate" required="true" type="FLOAT"/>
     <column name="create_datetime" required="true" type="TIMESTAMP"/>

     <foreign-key foreignTable="currency">
   	    <reference foreign="id" local="currency_id"/>
     </foreign-key> 
     <!-- can't make a foreign key constraint with the entity because the '0'
     	  entity_id is used for the defaults -->
  </table>

  <table name="ageing_entity_step" 
  	      description="The preferences of an entity for the ageing process">
     <column name="id" required="true" primaryKey="true" type="INTEGER"/>
     <column name="entity_id" required="false" type="INTEGER"/>
     <column name="status_id" required="false" type="INTEGER"/>
     <column name="days" required="true" type="INTEGER"/>
     
     <!-- welocome_message is international -->
     <!-- failed_login_message is international -->
     
     <foreign-key foreignTable="entity">
        <reference foreign="id" local="entity_id"/>
     </foreign-key> 
     <foreign-key foreignTable="user_status">
        <reference foreign="id" local="status_id"/>
     </foreign-key> 
  </table>  
  
</database>
